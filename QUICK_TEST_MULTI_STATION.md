# 🚀 快速多站點測試指南

## 📍 您現在的狀態
- ✅ 已下載 main 分支代碼
- ✅ 血庫列印標籤功能存在（在血袋管理頁面的入庫表單中）
- ✅ 同步管理標籤頁存在（頂部紫色按鈕）

## 🎯 單機多站點測試 - 最簡單方案

### 方案說明
使用 **單一後端 + 多個瀏覽器分頁** 模擬不同站點間的物資協作。

```
        FastAPI 後端 (localhost:8000)
              ↓        ↓
    [瀏覽器分頁1]  [瀏覽器分頁2]
     站點: TC-01    站點: TC-02
```

---

## 📝 測試步驟

### Step 1: 啟動後端服務

```bash
cd /home/user/medical-inventory-system_v1.4.1
python main.py
```

**預期輸出**：
```
INFO:     Uvicorn running on http://0.0.0.0:8000
INFO:     Application startup complete.
```

---

### Step 2: 設定第一個站點 (TC-01)

1. **開啟瀏覽器**，訪問：`http://localhost:8000`
2. **設定站點ID**：
   - 打開瀏覽器開發者工具 (F12)
   - 切換到 Console 標籤
   - 執行以下命令：
   ```javascript
   localStorage.setItem('stationId', 'TC-01');
   localStorage.setItem('stationName', '前線醫療站01');
   location.reload();
   ```
3. **頁面刷新後**，頂部應顯示「站點: TC-01」

---

### Step 3: 設定第二個站點 (TC-02)

1. **開啟新的瀏覽器分頁或視窗**
2. 訪問：`http://localhost:8000`
3. **設定站點ID**（同樣在 Console 中）：
   ```javascript
   localStorage.setItem('stationId', 'TC-02');
   localStorage.setItem('stationName', '後勤補給站02');
   location.reload();
   ```
4. **頁面刷新後**，頂部應顯示「站點: TC-02」

---

### Step 4: 在 TC-01 建立初始庫存

**在 TC-01 分頁中**：

1. 點擊「**物品管理**」標籤頁（藍色盒子圖標）
2. 新增一些物資：
   - 名稱：繃帶
   - 類別：醫療耗材
   - 數量：100
   - 單位：個
   - 位置：A-01
   - 點擊「確認入庫」

3. 新增更多物資：
   - 名稱：生理食鹽水
   - 數量：50
   - 單位：瓶
   - 位置：B-01

---

### Step 5: 測試站點間調撥

#### 在 TC-01 執行調撥

1. 在 TC-01 分頁，找到剛才入庫的「繃帶」
2. 點擊「調撥」按鈕
3. 填寫調撥資訊：
   - **目標站點ID**：TC-02
   - **調撥數量**：30
   - **備註**：緊急補給
4. 點擊「確認調撥」

**預期結果**：
- TC-01 的繃帶數量應該從 100 → 70
- 系統顯示調撥成功訊息

#### 在 TC-02 查看接收

1. **切換到 TC-02 分頁**
2. 點擊「**物品管理**」標籤頁
3. **刷新頁面** (F5)
4. 應該看到「繃帶」出現，數量為 30

---

### Step 6: 測試血袋管理與列印標籤

#### 在 TC-01 建立血袋庫存

1. 在 TC-01 分頁，點擊「**血袋管理**」標籤頁（紅色心形圖標）
2. 在「**血袋入庫**」區塊：
   - 血袋編號：BB-001
   - 血型：O+
   - 數量：10
   - 採集時間：選擇當前時間
3. 點擊「**列印標籤**」按鈕（藍色按鈕）
   - 會開啟新視窗顯示標籤，包含 QR Code
   - 可以直接列印 (Ctrl+P)

4. 點擊「**確認入庫**」

#### 測試血袋調撥

1. 在血袋列表中找到 BB-001
2. 點擊「站點轉移」按鈕
3. 填寫：
   - 目標站點：TC-02
   - 轉移數量：5
4. 確認轉移

5. **切換到 TC-02 分頁**，刷新頁面
6. 應該看到 BB-001 的 5 個單位出現在 TC-02

---

### Step 7: 測試同步管理功能

1. 點擊頂部的「**同步管理**」標籤頁（紫色循環箭頭圖標）
2. 應該看到：
   - 待同步變更數量
   - 已同步封包數量
   - 最後同步時間
   - 同步記錄列表

3. 點擊「**手動同步**」按鈕測試同步功能

---

## 🧪 測試場景建議

### 場景 1：前線支援
- TC-01（前線）消耗物資 → 向 TC-02（後勤）申請補給
- TC-02 調撥物資給 TC-01

### 場景 2：血袋緊急調度
- TC-01 接收大量傷患，血袋不足
- TC-02 緊急轉移血袋給 TC-01

### 場景 3：站點合併
- TC-03 即將撤離
- 將所有物資轉移到 TC-01
- 參考 `STATION_MERGE_GUIDE.md`

---

## 🔍 如何驗證測試成功

### 資料庫檢查
```bash
# 安裝 sqlite3（如果沒有）
sudo apt-get install sqlite3  # Linux
# 或 brew install sqlite3     # macOS

# 查看資料庫
sqlite3 database/medical_inventory.db

# 執行查詢
.tables
SELECT * FROM inventory WHERE station_id='TC-01';
SELECT * FROM transfers WHERE source_station='TC-01';
SELECT * FROM blood_inventory;
.quit
```

### 檢查調撥記錄
在任一站點：
1. 點擊「庫存查詢」
2. 點擊「歷史記錄」按鈕
3. 應該看到所有調撥記錄

---

## ⚠️ 常見問題

### Q1: 切換站點後看不到其他站點的物資？
✅ **正常**！每個站點只能看到自己的庫存。這是設計行為。

### Q2: 調撥後目標站點沒有顯示？
1. 確認目標站點 ID 正確（區分大小寫）
2. 在目標站點分頁按 F5 刷新
3. 檢查瀏覽器 Console 是否有錯誤訊息

### Q3: 找不到「列印標籤」按鈕？
1. 確認在「**血袋管理**」標籤頁
2. 向下滾動找到「**血袋入庫**」區塊
3. 按鈕在「確認入庫」旁邊（藍色）

### Q4: 找不到「同步管理」標籤頁？
1. 在頂部導航列找紫色的循環箭頭圖標
2. 如果螢幕較小，可能需要橫向滾動導航列

---

## 📊 測試檢查清單

- [ ] 成功啟動後端服務
- [ ] 設定 TC-01 和 TC-02 兩個站點
- [ ] 在 TC-01 建立物資庫存
- [ ] 從 TC-01 調撥物資到 TC-02
- [ ] 在 TC-02 確認收到物資
- [ ] 建立血袋庫存並列印標籤
- [ ] 執行血袋站點轉移
- [ ] 測試同步管理功能
- [ ] 查看歷史記錄和調撥記錄

---

## 🎓 進階測試

完成基本測試後，可以參考：
- `FEDERATED_ARCHITECTURE.md` - 聯邦式架構詳細說明
- `STATION_TRANSFER_PLAN.md` - 完整的站點轉移計劃
- `TESTING_DEPLOYMENT_GUIDE.md` - 測試與部署指南
- `MULTI_STATION_SETUP.md` - 多站點架構說明

---

## 📞 需要幫助？

如果遇到問題：
1. 檢查瀏覽器 Console (F12) 的錯誤訊息
2. 檢查後端終端的錯誤日誌
3. 確認 Python 依賴已正確安裝：
   ```bash
   pip install -r requirements_v1.4.1.txt
   ```

Happy Testing! 🎉
