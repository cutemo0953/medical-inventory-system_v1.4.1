# ğŸ¥ è¯é‚¦å¼ä¸‰å±¤æ¶æ§‹è¨­è¨ˆ

## ğŸ“‹ æ¶æ§‹æ¦‚è¿°

### è¨­è¨ˆåŸå‰‡
æœ¬æ¶æ§‹é‡å°æˆ°æ™‚/ç½å®³æƒ…å¢ƒä¸‹çš„é†«ç™‚ç‰©è³‡ç®¡ç†ï¼Œè€ƒé‡ä»¥ä¸‹å¯¦éš›éœ€æ±‚ï¼š
- **ç¶²è·¯å—é™**: åƒ…å¤§ç«™æˆ–é†«é™¢è¡Œæ”¿å–®ä½å¯é€éè»è­¦ç®¡é“è¯ç¶²
- **å±¤ç´šç®¡ç†**: ä¸­å¤®æŒ‡æ® â†’ é†«é™¢ â†’ é†«ç™‚ç«™ä¸‰å±¤æ¶æ§‹
- **é«˜é »å…§éƒ¨å”ä½œ**: é†«é™¢å…§ç«™é»é–“é »ç¹åŒæ­¥èˆ‡ç‰©è³‡è«‹æ±‚
- **è¤‡é›œè·¨é™¢è«‹æ±‚**: é†«é™¢é–“ç‰©è³‡è«‹æ±‚éœ€å¯©æ‰¹æµç¨‹
- **æˆ°å ´é©æ‡‰æ€§**: æ”¯æ´å®Œå…¨é›¢ç·šé‹ä½œèˆ‡å¯¦é«”è³‡æ–™è½‰ç§»

---

## ğŸ—ï¸ ä¸‰å±¤æ¶æ§‹è¨­è¨ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ğŸ›ï¸ ä¸­å¤®æŒ‡æ®å±¤                                â”‚
â”‚              (è¡›ç¦éƒ¨ / åœ°æ–¹è¡›ç”Ÿå±€ / æˆ°å€æŒ‡æ®éƒ¨)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Central Command Database (Master)                        â”‚  â”‚
â”‚  â”‚  â€¢ å…¨åœ‹/æˆ°å€ç¸½è¦½                                           â”‚  â”‚
â”‚  â”‚  â€¢ æ¥æ”¶å„é†«é™¢ç‹€æ…‹å ±å‘Š                                      â”‚  â”‚
â”‚  â”‚  â€¢ å¯©æ‰¹è·¨é†«é™¢ç‰©è³‡èª¿æ’¥                                      â”‚  â”‚
â”‚  â”‚  â€¢ æˆ°ç•¥è³‡æºèª¿é…æ±ºç­–                                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†• (è»è­¦å°ˆç·š/è¡›æ˜Ÿé€šè¨Š - å®šæœŸç‹€æ…‹å ±å‘Š)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ğŸ¥ é†«é™¢å±¤ (Hospital Level)                   â”‚
â”‚              ä¸€å€‹é†«é™¢çµ±ç±Œ 5-40 å€‹é†«ç™‚ç«™                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Hospital Aggregate Database                              â”‚  â”‚
â”‚  â”‚  â€¢ æ•´åˆæ‰€å±¬æ‰€æœ‰ç«™é»è³‡æ–™                                    â”‚  â”‚
â”‚  â”‚  â€¢ é†«é™¢å…§ç‰©è³‡èª¿æ’¥å”èª¿                                      â”‚  â”‚
â”‚  â”‚  â€¢ å‘ä¸­å¤®å ±å‘Šå½™ç¸½ç‹€æ…‹                                      â”‚  â”‚
â”‚  â”‚  â€¢ è™•ç†è·¨é†«é™¢è«‹æ±‚                                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚  éƒ¨ç½²ä½ç½®: é†«é™¢è¡Œæ”¿æ ¸å¿ƒå–®ä½ (æœ‰è¯ç¶²æ¬Šé™)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†• (é™¢å…§ç¶²è·¯/å¯¦é«”è½‰ç§» - é«˜é »åŒæ­¥)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   âš•ï¸ é†«ç™‚ç«™å±¤ (Station Level)                   â”‚
â”‚                      æ¯å€‹é†«é™¢ 5-40 å€‹ç«™é»                         â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚   ğŸ¥ å¤§ç«™ (Large)    â”‚      â”‚   ğŸš‘ å°ç«™ (Small)    â”‚          â”‚
â”‚  â”‚  â€¢ å¯åŸ·è¡Œæ‰‹è¡“        â”‚      â”‚  â€¢ ç°¡æ˜“æ›è—¥æ­¢è¡€      â”‚          â”‚
â”‚  â”‚  â€¢ å®Œæ•´è¨­å‚™èˆ‡äººåŠ›     â”‚      â”‚  â€¢ åŸºç¤ç‰©è³‡         â”‚          â”‚
â”‚  â”‚  â€¢ å¯èƒ½æœ‰è¯ç¶²æ¬Šé™     â”‚      â”‚  â€¢ é€šå¸¸ç„¡ç¶²è·¯       â”‚          â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚      â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚          â”‚
â”‚  â”‚  â”‚ Local DB      â”‚  â”‚      â”‚  â”‚ Local DB      â”‚  â”‚          â”‚
â”‚  â”‚  â”‚ (ç¨ç«‹é‹ä½œ)     â”‚  â”‚      â”‚  â”‚ (ç¨ç«‹é‹ä½œ)     â”‚  â”‚          â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚          â†• (ç¶²è·¯/USB)                 â†• (USB/äººåŠ›)              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚              é†«é™¢å½™ç¸½è³‡æ–™åº«                          â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—„ï¸ è³‡æ–™åº«éƒ¨ç½²ç­–ç•¥

### æ–¹æ¡ˆï¼šæ··åˆå¼è¯é‚¦æ¶æ§‹

#### 1. ç«™é»å±¤è³‡æ–™åº« (Station-Level DB)
```
ä½ç½®: æ¯å€‹é†«ç™‚ç«™ç¨ç«‹é‹ä½œ
æŠ€è¡“: SQLite (è¼•é‡ã€é›¢ç·šå„ªå…ˆ)
åŠŸèƒ½:
  âœ“ å®Œå…¨é›¢ç·šé‹ä½œ
  âœ“ æœ¬ç«™ç‰©è³‡ã€è¡€è¢‹ã€è¨­å‚™ã€æ‰‹è¡“è¨˜éŒ„
  âœ“ ç”ŸæˆåŒæ­¥å°åŒ… (sync packages)
  âœ“ åŒ¯å…¥å…¶ä»–ç«™é»è³‡æ–™
```

**è³‡æ–™ç¯„åœ:**
- ç«™é»ID: `TC-01`, `TC-02`, ..., `TC-40`
- é†«é™¢ID: `HOSP-001`
- åƒ…ç®¡ç†æœ¬ç«™è³‡æºèˆ‡è¨˜éŒ„

#### 2. é†«é™¢å±¤è³‡æ–™åº« (Hospital-Level DB)
```
ä½ç½®: é†«é™¢è¡Œæ”¿æ ¸å¿ƒå–®ä½ (æœ‰è¯ç¶²æ¬Šé™)
æŠ€è¡“: SQLite æˆ– PostgreSQL (æ”¯æ´æ›´å¤§è³‡æ–™é‡)
åŠŸèƒ½:
  âœ“ å½™ç¸½æ‰€å±¬ 5-40 å€‹ç«™é»è³‡æ–™
  âœ“ é†«é™¢å…§ç‰©è³‡èª¿æ’¥å”èª¿ä¸­å¿ƒ
  âœ“ æ¥æ”¶ç«™é»åŒæ­¥å°åŒ…
  âœ“ å‘ä¸­å¤®å ±å‘Šå½™ç¸½ç‹€æ…‹
  âœ“ è™•ç†è·¨é†«é™¢è«‹æ±‚å¯©æ‰¹
```

**è³‡æ–™ç¯„åœ:**
- é†«é™¢ID: `HOSP-001`
- ç«™é»: `TC-01` ~ `TC-40`
- åŒ…å«æ‰€æœ‰ç«™é»çš„å½™ç¸½è³‡æ–™

#### 3. ä¸­å¤®å±¤è³‡æ–™åº« (Central-Level DB)
```
ä½ç½®: è¡›ç¦éƒ¨/åœ°æ–¹è¡›ç”Ÿå±€/æˆ°å€æŒ‡æ®éƒ¨
æŠ€è¡“: PostgreSQL (é«˜å¯ç”¨æ€§ã€å¤§è¦æ¨¡)
åŠŸèƒ½:
  âœ“ å…¨åœ‹/æˆ°å€ç¸½è¦½
  âœ“ æ¥æ”¶å„é†«é™¢ç‹€æ…‹å ±å‘Š
  âœ“ å¯©æ‰¹è·¨é†«é™¢ç‰©è³‡èª¿æ’¥
  âœ“ æˆ°ç•¥è³‡æºèª¿é…æ±ºç­–
  âœ“ é•·æœŸæ•¸æ“šåˆ†æèˆ‡çµ±è¨ˆ
```

**è³‡æ–™ç¯„åœ:**
- æ‰€æœ‰é†«é™¢: `HOSP-001`, `HOSP-002`, ...
- å½™ç¸½è³‡æ–™ï¼Œä¸åŒ…å«æ¯å€‹ç«™é»çš„è©³ç´°è¨˜éŒ„
- æ¥æ”¶é†«é™¢å±¤çš„å®šæœŸå ±å‘Š

---

## ğŸ”„ åŒæ­¥æ©Ÿåˆ¶è¨­è¨ˆ

### 1. é™¢å…§åŒæ­¥ (Intra-Hospital Sync)

#### é »ç‡: é«˜é » (æ¯å°æ™‚æˆ–æ›´é »ç¹)

#### å ´æ™¯ A: å¤§ç«™ â†’ é†«é™¢å½™ç¸½ (æœ‰ç¶²è·¯)
```
æµç¨‹:
1. å¤§ç«™ TC-01 ç”¢ç”Ÿå¢é‡åŒæ­¥å°åŒ… (delta sync)
2. é€éé™¢å…§ç¶²è·¯ POST /api/hospital/sync/upload
3. é†«é™¢å½™ç¸½è³‡æ–™åº«åˆä½µè³‡æ–™
4. è¿”å›ç¢ºèªèˆ‡å…¶ä»–ç«™é»æ›´æ–°

åŒæ­¥å…§å®¹:
  â€¢ ç‰©è³‡ç•°å‹•è¨˜éŒ„
  â€¢ è¡€è¢‹æ”¶ç™¼è¨˜éŒ„
  â€¢ è¨­å‚™ç‹€æ…‹è®Šæ›´
  â€¢ æ–°å¢æ‰‹è¡“è¨˜éŒ„
```

#### å ´æ™¯ B: å°ç«™ â†’ é†«é™¢å½™ç¸½ (ç„¡ç¶²è·¯ï¼Œéœ€å¯¦é«”è½‰ç§»)
```
æµç¨‹:
1. å°ç«™ TC-05 ç”¢ç”ŸåŒæ­¥å°åŒ… (.sync æª”æ¡ˆ)
2. é†«è­·äººå“¡å·¡è¿´æ™‚ä»¥ USB æ”¶é›†
3. é€è‡³é†«é™¢è¡Œæ”¿å–®ä½
4. åŒ¯å…¥: POST /api/hospital/sync/import (multipart/form-data)
5. é†«é™¢ç”¢ç”Ÿå›å‚³å°åŒ… (å…¶ä»–ç«™é»æ›´æ–°)
6. ä¸‹æ¬¡å·¡è¿´æ™‚ USB é€å›å°ç«™

åŒæ­¥å°åŒ…æ ¼å¼:
{
  "hospital_id": "HOSP-001",
  "station_id": "TC-05",
  "sync_timestamp": "2025-11-12T14:30:00",
  "changes": [
    {
      "table": "transactions",
      "operation": "INSERT",
      "data": {...}
    },
    {
      "table": "blood_inventory",
      "operation": "UPDATE",
      "data": {...}
    }
  ],
  "checksum": "sha256_hash"
}
```

### 2. è·¨é™¢åŒæ­¥ (Inter-Hospital Sync)

#### é »ç‡: ä½é » (æ¯æ—¥æˆ–æŒ‰éœ€)

#### å ´æ™¯: é†«é™¢ A è«‹æ±‚é†«é™¢ B æ”¯æ´ç‰©è³‡
```
æµç¨‹:
1. HOSP-001 (é†«é™¢A) ç™¼èµ·è«‹æ±‚
   POST /api/central/transfer-request
   {
     "from_hospital": "HOSP-002",
     "to_hospital": "HOSP-001",
     "resource_type": "ITEM",
     "item_code": "SURG-001",
     "quantity": 100,
     "urgency": "HIGH",
     "reason": "å¤§é‡å‚·æ‚£ï¼Œå¤–ç§‘è€—æçŸ­ç¼º"
   }

2. ä¸­å¤®æŒ‡æ®éƒ¨å¯©æ‰¹
   - è‡ªå‹•å¯©æ‰¹ (ç¬¦åˆé è¨­è¦å‰‡)
   - äººå·¥å¯©æ‰¹ (è¤‡é›œæƒ…æ³)

3. å¯©æ‰¹é€šéå¾Œé€šçŸ¥ HOSP-002
   GET /api/central/pending-requests (HOSP-002 å®šæœŸæŸ¥è©¢)

4. HOSP-002 ç¢ºèªåŸ·è¡Œ
   POST /api/central/transfer-confirm
   {
     "request_id": "REQ-20251112-001",
     "status": "APPROVED",
     "actual_quantity": 100,
     "expected_delivery": "2025-11-12T18:00:00"
   }

5. å¯¦é«”é‹é€ + è³‡æ–™åŒæ­¥
   - ç‰©è³‡é€éè»è­¦ç®¡é“é‹é€
   - åŒæ™‚ç”¢ç”Ÿèª¿æ’¥è¨˜éŒ„åŒæ­¥åˆ°ä¸­å¤®
   - ä¸­å¤®é€šçŸ¥ HOSP-001 ç‰©è³‡å·²ç™¼å‡º

6. HOSP-001 æ”¶åˆ°ç‰©è³‡å¾Œç¢ºèª
   POST /api/central/transfer-received
   {
     "request_id": "REQ-20251112-001",
     "received_quantity": 100,
     "received_at": "2025-11-12T17:45:00"
   }
```

### 3. å‘ä¸­å¤®å ±å‘Š (Reporting to Central)

#### é »ç‡: å®šæœŸ (æ¯æ—¥) + ç·Šæ€¥ (å³æ™‚)

#### å®šæœŸç‹€æ…‹å ±å‘Š
```
é†«é™¢æ¯æ—¥å½™ç¸½å ±å‘Š:
POST /api/central/report/daily

{
  "hospital_id": "HOSP-001",
  "report_date": "2025-11-12",
  "summary": {
    "total_stations": 25,
    "operational_stations": 23,
    "offline_stations": 2,
    "total_patients_treated": 147,
    "critical_patients": 12,
    "surgeries_performed": 8,
    "blood_inventory": {
      "O+": 150,
      "O-": 45,
      "A+": 120,
      "A-": 30,
      "B+": 90,
      "B-": 25,
      "AB+": 40,
      "AB-": 15
    },
    "critical_shortages": [
      {
        "item_code": "SURG-001",
        "item_name": "å¤–ç§‘ç¸«åˆé‡",
        "current_quantity": 15,
        "threshold": 50,
        "urgency": "HIGH"
      }
    ],
    "equipment_status": {
      "operational": 45,
      "maintenance_needed": 3,
      "broken": 2
    }
  },
  "alerts": [
    {
      "type": "SHORTAGE",
      "severity": "HIGH",
      "message": "å¤–ç§‘ç¸«åˆé‡åº«å­˜ä½æ–¼å®‰å…¨å€¼"
    }
  ]
}
```

#### ç·Šæ€¥é€šå ±
```
POST /api/central/report/emergency

{
  "hospital_id": "HOSP-001",
  "emergency_type": "MASS_CASUALTY",
  "severity": "CRITICAL",
  "message": "å¤§é‡å‚·æ‚£æ¹§å…¥ï¼ŒOå‹è¡€è¢‹ç·Šæ€¥çŸ­ç¼º",
  "resource_needs": [
    {
      "resource_type": "BLOOD",
      "blood_type": "O+",
      "quantity_needed": 50,
      "urgency": "IMMEDIATE"
    }
  ],
  "timestamp": "2025-11-12T15:30:00"
}
```

---

## ğŸ“Š è³‡æ–™åº«æ¶æ§‹æ“´å……

### 1. æ–°å¢é†«é™¢å¯¦é«”

```sql
-- é†«é™¢åŸºæœ¬è³‡æ–™
CREATE TABLE hospitals (
    hospital_id TEXT PRIMARY KEY,           -- HOSP-001, HOSP-002
    hospital_name TEXT NOT NULL,            -- å‰ç·šç¬¬ä¸€é†«é™¢
    hospital_type TEXT NOT NULL,            -- FIELD_HOSPITAL, CIVILIAN_HOSPITAL
    command_level TEXT NOT NULL,            -- CENTRAL, REGIONAL, LOCAL
    latitude REAL,                          -- GPS åº§æ¨™
    longitude REAL,
    contact_info TEXT,                      -- è¯çµ¡è³‡è¨Š
    network_access TEXT DEFAULT 'NONE',    -- NONE, MILITARY, SATELLITE
    total_stations INTEGER DEFAULT 0,       -- æ‰€å±¬ç«™é»ç¸½æ•¸
    operational_status TEXT DEFAULT 'ACTIVE', -- ACTIVE, OFFLINE, EVACUATED
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CHECK(hospital_type IN ('FIELD_HOSPITAL', 'CIVILIAN_HOSPITAL', 'MOBILE_HOSPITAL')),
    CHECK(command_level IN ('CENTRAL', 'REGIONAL', 'LOCAL')),
    CHECK(network_access IN ('NONE', 'MILITARY', 'SATELLITE', 'CIVILIAN')),
    CHECK(operational_status IN ('ACTIVE', 'OFFLINE', 'EVACUATED', 'MERGED'))
);

-- ç«™é»åŸºæœ¬è³‡æ–™ (æ“´å……ç¾æœ‰ stations è¡¨)
ALTER TABLE stations ADD COLUMN hospital_id TEXT REFERENCES hospitals(hospital_id);
ALTER TABLE stations ADD COLUMN station_type TEXT DEFAULT 'SMALL';
  -- LARGE (å¯æ‰‹è¡“), SMALL (åŸºç¤ç…§è­·)
ALTER TABLE stations ADD COLUMN network_access TEXT DEFAULT 'NONE';
  -- NONE, INTRANET, MILITARY
ALTER TABLE stations ADD COLUMN last_sync_at TIMESTAMP;
  -- ä¸Šæ¬¡åŒæ­¥æ™‚é–“
ALTER TABLE stations ADD COLUMN sync_status TEXT DEFAULT 'PENDING';
  -- PENDING, SYNCING, SYNCED, FAILED
```

### 2. è·¨é™¢èª¿æ’¥è«‹æ±‚è¡¨

```sql
CREATE TABLE inter_hospital_requests (
    request_id TEXT PRIMARY KEY,                  -- REQ-YYMMDD-SEQ
    request_type TEXT NOT NULL,                   -- TRANSFER, SUPPORT, MERGE
    from_hospital_id TEXT NOT NULL,               -- ä¾†æºé†«é™¢
    to_hospital_id TEXT NOT NULL,                 -- ç›®æ¨™é†«é™¢
    resource_type TEXT NOT NULL,                  -- ITEM, BLOOD, EQUIPMENT, PERSONNEL
    resource_id TEXT NOT NULL,                    -- è³‡æºID
    resource_name TEXT NOT NULL,                  -- è³‡æºåç¨±
    quantity_requested INTEGER NOT NULL,          -- è«‹æ±‚æ•¸é‡
    quantity_approved INTEGER,                    -- å¯©æ‰¹æ•¸é‡
    quantity_delivered INTEGER,                   -- å¯¦éš›é€é”æ•¸é‡
    urgency TEXT NOT NULL,                        -- LOW, MEDIUM, HIGH, CRITICAL
    reason TEXT NOT NULL,                         -- è«‹æ±‚åŸå› 
    status TEXT DEFAULT 'PENDING',                -- PENDING, APPROVED, REJECTED, IN_TRANSIT, COMPLETED, CANCELLED
    requested_by TEXT NOT NULL,                   -- è«‹æ±‚äºº
    requested_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    approved_by TEXT,                             -- å¯©æ‰¹äºº
    approved_at TIMESTAMP,
    approval_notes TEXT,                          -- å¯©æ‰¹å‚™è¨»
    delivered_at TIMESTAMP,                       -- é€é”æ™‚é–“
    received_by TEXT,                             -- æ¥æ”¶äºº
    completion_notes TEXT,                        -- å®Œæˆå‚™è¨»
    CHECK(request_type IN ('TRANSFER', 'SUPPORT', 'MERGE')),
    CHECK(resource_type IN ('ITEM', 'BLOOD', 'EQUIPMENT', 'PERSONNEL')),
    CHECK(urgency IN ('LOW', 'MEDIUM', 'HIGH', 'CRITICAL')),
    CHECK(status IN ('PENDING', 'APPROVED', 'REJECTED', 'IN_TRANSIT', 'COMPLETED', 'CANCELLED'))
);

CREATE INDEX idx_inter_hospital_requests_status ON inter_hospital_requests(status);
CREATE INDEX idx_inter_hospital_requests_hospitals ON inter_hospital_requests(from_hospital_id, to_hospital_id);
CREATE INDEX idx_inter_hospital_requests_date ON inter_hospital_requests(requested_at DESC);
```

### 3. åŒæ­¥å°åŒ…è¿½è¹¤è¡¨

```sql
CREATE TABLE sync_packages (
    package_id TEXT PRIMARY KEY,                  -- PKG-YYMMDD-HHMMSS-SEQ
    package_type TEXT NOT NULL,                   -- DELTA, FULL, REPORT
    source_type TEXT NOT NULL,                    -- STATION, HOSPITAL
    source_id TEXT NOT NULL,                      -- TC-01, HOSP-001
    destination_type TEXT NOT NULL,               -- HOSPITAL, CENTRAL
    destination_id TEXT NOT NULL,                 -- HOSP-001, CENTRAL-01
    hospital_id TEXT NOT NULL,                    -- æ‰€å±¬é†«é™¢
    transfer_method TEXT NOT NULL,                -- NETWORK, USB, MANUAL
    package_size INTEGER,                         -- å°åŒ…å¤§å° (bytes)
    checksum TEXT NOT NULL,                       -- SHA-256 æ ¡é©—ç¢¼
    changes_count INTEGER DEFAULT 0,              -- è®Šæ›´è¨˜éŒ„æ•¸
    status TEXT DEFAULT 'PENDING',                -- PENDING, UPLOADED, PROCESSING, APPLIED, FAILED
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    uploaded_at TIMESTAMP,
    processed_at TIMESTAMP,
    error_message TEXT,                           -- éŒ¯èª¤è¨Šæ¯
    CHECK(package_type IN ('DELTA', 'FULL', 'REPORT')),
    CHECK(source_type IN ('STATION', 'HOSPITAL')),
    CHECK(destination_type IN ('HOSPITAL', 'CENTRAL')),
    CHECK(transfer_method IN ('NETWORK', 'USB', 'MANUAL', 'DRONE')),
    CHECK(status IN ('PENDING', 'UPLOADED', 'PROCESSING', 'APPLIED', 'FAILED'))
);

CREATE INDEX idx_sync_packages_status ON sync_packages(status);
CREATE INDEX idx_sync_packages_source ON sync_packages(source_type, source_id);
CREATE INDEX idx_sync_packages_destination ON sync_packages(destination_type, destination_id);
CREATE INDEX idx_sync_packages_hospital ON sync_packages(hospital_id);
CREATE INDEX idx_sync_packages_date ON sync_packages(created_at DESC);
```

### 4. é†«é™¢å½™ç¸½å ±è¡¨

```sql
CREATE TABLE hospital_daily_reports (
    report_id TEXT PRIMARY KEY,                   -- RPT-YYMMDD-HOSP-001
    hospital_id TEXT NOT NULL,
    report_date DATE NOT NULL,
    total_stations INTEGER NOT NULL,
    operational_stations INTEGER NOT NULL,
    offline_stations INTEGER NOT NULL,
    total_patients_treated INTEGER DEFAULT 0,
    critical_patients INTEGER DEFAULT 0,
    surgeries_performed INTEGER DEFAULT 0,
    blood_inventory_json TEXT,                    -- JSON: {"O+": 150, "A+": 120, ...}
    critical_shortages_json TEXT,                 -- JSON: [{"item_code": "...", "urgency": "HIGH"}]
    equipment_status_json TEXT,                   -- JSON: {"operational": 45, "broken": 2}
    alerts_json TEXT,                             -- JSON: [{"type": "SHORTAGE", "severity": "HIGH"}]
    submitted_by TEXT NOT NULL,
    submitted_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    received_by_central BOOLEAN DEFAULT FALSE,
    received_at TIMESTAMP,
    UNIQUE(hospital_id, report_date)
);

CREATE INDEX idx_hospital_reports_date ON hospital_daily_reports(report_date DESC);
CREATE INDEX idx_hospital_reports_hospital ON hospital_daily_reports(hospital_id);
```

---

## ğŸ”Œ API è¨­è¨ˆ

### ç«™é»å±¤ API (Station-Level APIs)

#### 1. ç”¢ç”ŸåŒæ­¥å°åŒ…
```http
POST /api/station/sync/generate
Content-Type: application/json

{
  "station_id": "TC-01",
  "hospital_id": "HOSP-001",
  "sync_type": "DELTA",        // DELTA (å¢é‡) / FULL (å…¨é‡)
  "since_timestamp": "2025-11-12T10:00:00"  // å¢é‡åŒæ­¥èµ·å§‹æ™‚é–“
}

Response:
{
  "success": true,
  "package_id": "PKG-20251112-143000-001",
  "package_file": "/downloads/sync/PKG-20251112-143000-001.sync",
  "package_size": 45678,
  "checksum": "abc123...",
  "changes_count": 23,
  "message": "åŒæ­¥å°åŒ…å·²ç”¢ç”Ÿï¼Œå¯ä¸‹è¼‰æˆ–ä¸Šå‚³"
}
```

#### 2. åŒ¯å…¥åŒæ­¥å°åŒ… (å¾é†«é™¢ä¸‹è¼‰)
```http
POST /api/station/sync/import
Content-Type: multipart/form-data

package_file: (binary .sync file)

Response:
{
  "success": true,
  "package_id": "PKG-20251112-143000-002",
  "changes_applied": 15,
  "conflicts_detected": 2,
  "conflicts": [
    {
      "table": "items",
      "item_code": "SURG-001",
      "conflict_type": "QUANTITY_MISMATCH",
      "local_value": 50,
      "remote_value": 48,
      "resolution": "KEEP_HIGHER"
    }
  ],
  "message": "åŒæ­¥å®Œæˆï¼Œå·²å¥—ç”¨15é …è®Šæ›´"
}
```

---

### é†«é™¢å±¤ API (Hospital-Level APIs)

#### 1. æ¥æ”¶ç«™é»åŒæ­¥ä¸Šå‚³
```http
POST /api/hospital/sync/upload
Content-Type: application/json

{
  "station_id": "TC-01",
  "package_id": "PKG-20251112-143000-001",
  "changes": [
    {
      "table": "transactions",
      "operation": "INSERT",
      "data": {
        "transaction_type": "CONSUME",
        "item_code": "SURG-001",
        "quantity": 5,
        "station_id": "TC-01",
        "timestamp": "2025-11-12T14:00:00"
      }
    }
  ],
  "checksum": "abc123..."
}

Response:
{
  "success": true,
  "package_id": "PKG-20251112-143000-001",
  "status": "APPLIED",
  "changes_applied": 23,
  "conflicts": 0,
  "response_package_id": "PKG-20251112-143500-002",  // å›å‚³å°åŒ…ï¼ˆå…¶ä»–ç«™é»æ›´æ–°ï¼‰
  "message": "åŒæ­¥å®Œæˆï¼Œå·²ç”¢ç”Ÿå›å‚³å°åŒ…"
}
```

#### 2. é™¢å…§ç‰©è³‡èª¿æ’¥å”èª¿
```http
POST /api/hospital/transfer/coordinate
Content-Type: application/json

{
  "hospital_id": "HOSP-001",
  "from_station_id": "TC-01",
  "to_station_id": "TC-05",
  "resource_type": "ITEM",
  "item_code": "SURG-001",
  "quantity": 20,
  "operator": "å¼µè­·ç†é•·",
  "reason": "TC-05 ç·Šæ€¥æ‰‹è¡“éœ€æ±‚"
}

Response:
{
  "success": true,
  "transfer_id": "TRF-20251112-001",
  "from_station_id": "TC-01",
  "to_station_id": "TC-05",
  "resource_type": "ITEM",
  "item_code": "SURG-001",
  "quantity": 20,
  "status": "PENDING_PICKUP",  // ç­‰å¾… TC-05 ä¸‹æ¬¡åŒæ­¥æ™‚æ¥æ”¶
  "message": "èª¿æ’¥å·²ç™»è¨˜ï¼ŒTC-05 ä¸‹æ¬¡åŒæ­¥æ™‚æœƒæ”¶åˆ°ç‰©è³‡è¨˜éŒ„"
}
```

#### 3. å‘ä¸­å¤®æäº¤æ—¥å ±
```http
POST /api/hospital/report/daily
Content-Type: application/json

{
  "hospital_id": "HOSP-001",
  "report_date": "2025-11-12",
  "summary": {
    "total_stations": 25,
    "operational_stations": 23,
    "offline_stations": 2,
    "total_patients_treated": 147,
    "critical_patients": 12,
    "surgeries_performed": 8,
    "blood_inventory": {...},
    "critical_shortages": [...],
    "equipment_status": {...}
  },
  "alerts": [...]
}

Response:
{
  "success": true,
  "report_id": "RPT-20251112-HOSP-001",
  "submitted_at": "2025-11-12T18:00:00",
  "received_by_central": true,
  "message": "æ—¥å ±å·²æäº¤è‡³ä¸­å¤®æŒ‡æ®éƒ¨"
}
```

---

### ä¸­å¤®å±¤ API (Central-Level APIs)

#### 1. æ¥æ”¶é†«é™¢æ—¥å ±
```http
GET /api/central/reports/hospitals?date=2025-11-12&hospital_id=HOSP-001

Response:
{
  "reports": [
    {
      "report_id": "RPT-20251112-HOSP-001",
      "hospital_id": "HOSP-001",
      "hospital_name": "å‰ç·šç¬¬ä¸€é†«é™¢",
      "report_date": "2025-11-12",
      "summary": {...},
      "alerts": [...],
      "submitted_at": "2025-11-12T18:00:00"
    }
  ],
  "count": 1
}
```

#### 2. è·¨é™¢èª¿æ’¥è«‹æ±‚
```http
POST /api/central/transfer-request
Content-Type: application/json

{
  "from_hospital_id": "HOSP-002",
  "to_hospital_id": "HOSP-001",
  "resource_type": "ITEM",
  "item_code": "SURG-001",
  "quantity_requested": 100,
  "urgency": "HIGH",
  "reason": "å¤§é‡å‚·æ‚£ï¼Œå¤–ç§‘è€—æçŸ­ç¼º",
  "requested_by": "HOSP-001 é™¢é•·"
}

Response:
{
  "success": true,
  "request_id": "REQ-20251112-001",
  "status": "PENDING_APPROVAL",
  "message": "è«‹æ±‚å·²æäº¤ï¼Œç­‰å¾…ä¸­å¤®å¯©æ‰¹"
}
```

#### 3. å¯©æ‰¹è·¨é™¢è«‹æ±‚
```http
POST /api/central/transfer-request/{request_id}/approve
Content-Type: application/json

{
  "approved_by": "ä¸­å¤®æŒ‡æ®å®˜",
  "quantity_approved": 100,
  "approval_notes": "åŒæ„æ”¯æ´ï¼Œè«‹æ–¼ä»Šæ—¥18:00å‰é€é”",
  "delivery_method": "MILITARY_CONVOY"  // è»äº‹è»ŠéšŠé‹é€
}

Response:
{
  "success": true,
  "request_id": "REQ-20251112-001",
  "status": "APPROVED",
  "from_hospital_id": "HOSP-002",
  "to_hospital_id": "HOSP-001",
  "quantity_approved": 100,
  "message": "å·²å¯©æ‰¹é€šéï¼Œå·²é€šçŸ¥ HOSP-002 æº–å‚™ç‰©è³‡"
}
```

#### 4. å…¨åœ‹è³‡æºç¸½è¦½
```http
GET /api/central/overview/resources?resource_type=BLOOD

Response:
{
  "resource_type": "BLOOD",
  "total_hospitals": 15,
  "total_inventory": {
    "O+": 2340,
    "O-": 567,
    "A+": 1890,
    "A-": 456,
    "B+": 1234,
    "B-": 345,
    "AB+": 678,
    "AB-": 234
  },
  "hospitals": [
    {
      "hospital_id": "HOSP-001",
      "hospital_name": "å‰ç·šç¬¬ä¸€é†«é™¢",
      "inventory": {
        "O+": 150,
        "O-": 45,
        ...
      },
      "shortages": ["O+", "AB-"],
      "last_reported": "2025-11-12T18:00:00"
    },
    ...
  ],
  "critical_shortages": [
    {
      "hospital_id": "HOSP-003",
      "blood_type": "O+",
      "current_quantity": 5,
      "urgency": "CRITICAL"
    }
  ]
}
```

---

## ğŸš€ å¯¦ä½œéšæ®µ

### Phase 0: è³‡æ–™åº«èˆ‡åŸºç¤æ¶æ§‹ (1-2 é€±)

#### 0.1 è³‡æ–™åº«æ“´å……
- [ ] å»ºç«‹ `hospitals` è¡¨
- [ ] æ“´å…… `stations` è¡¨ (æ–°å¢ hospital_id, station_type, network_access)
- [ ] å»ºç«‹ `inter_hospital_requests` è¡¨
- [ ] å»ºç«‹ `sync_packages` è¡¨
- [ ] å»ºç«‹ `hospital_daily_reports` è¡¨

#### 0.2 åŸºç¤ API
- [ ] é†«é™¢ç®¡ç† API (CRUD)
- [ ] ç«™é»åˆ†é¡èˆ‡é†«é™¢æ­¸å±¬è¨­å®š

---

### Phase 1: é™¢å…§åŒæ­¥æ©Ÿåˆ¶ (2-3 é€±)

#### 1.1 ç«™é»å±¤åŠŸèƒ½
- [ ] åŒæ­¥å°åŒ…ç”¢ç”Ÿ API
- [ ] åŒæ­¥å°åŒ…åŒ¯å…¥ API
- [ ] å¢é‡è®Šæ›´è¿½è¹¤æ©Ÿåˆ¶
- [ ] è¡çªæª¢æ¸¬èˆ‡è§£æ±º

#### 1.2 é†«é™¢å±¤åŠŸèƒ½
- [ ] æ¥æ”¶ç«™é»åŒæ­¥ä¸Šå‚³ API
- [ ] å½™ç¸½å¤šç«™é»è³‡æ–™
- [ ] ç”¢ç”Ÿå›å‚³å°åŒ…ï¼ˆå…¶ä»–ç«™é»æ›´æ–°ï¼‰

#### 1.3 å‰ç«¯ UI
- [ ] ç«™é»è¨­å®šé ï¼šé¸æ“‡æ‰€å±¬é†«é™¢
- [ ] åŒæ­¥ç®¡ç†é ï¼šä¸Šå‚³/ä¸‹è¼‰åŒæ­¥å°åŒ…
- [ ] åŒæ­¥ç‹€æ…‹é¡¯ç¤ºï¼ˆä¸Šæ¬¡åŒæ­¥æ™‚é–“ã€å¾…åŒæ­¥è®Šæ›´æ•¸ï¼‰

---

### Phase 2: é™¢å…§èª¿æ’¥å”èª¿ (1-2 é€±)

#### 2.1 èª¿æ’¥å”èª¿ API
- [ ] é†«é™¢å±¤èª¿æ’¥å”èª¿ API
- [ ] èª¿æ’¥è¨˜éŒ„æŸ¥è©¢
- [ ] èª¿æ’¥ç‹€æ…‹è¿½è¹¤

#### 2.2 å‰ç«¯ UI
- [ ] é†«é™¢è³‡æºç¸½è¦½å„€è¡¨æ¿ï¼ˆåƒ…é†«é™¢è¡Œæ”¿å–®ä½å¯è¦‹ï¼‰
- [ ] é™¢å…§èª¿æ’¥å”èª¿ä»‹é¢
- [ ] ç«™é»é–“èª¿æ’¥è¨˜éŒ„æŸ¥è©¢

---

### Phase 3: è·¨é™¢è«‹æ±‚èˆ‡å¯©æ‰¹ (2-3 é€±)

#### 3.1 è·¨é™¢è«‹æ±‚ API
- [ ] æäº¤è·¨é™¢èª¿æ’¥è«‹æ±‚ API
- [ ] æŸ¥è©¢å¾…å¯©æ‰¹è«‹æ±‚ API
- [ ] å¯©æ‰¹/æ‹’çµ•è«‹æ±‚ API
- [ ] ç¢ºèªé€é” API

#### 3.2 å‰ç«¯ UI
- [ ] è·¨é™¢è«‹æ±‚æäº¤è¡¨å–®ï¼ˆé†«é™¢å±¤ï¼‰
- [ ] å¾…å¯©æ‰¹è«‹æ±‚åˆ—è¡¨ï¼ˆä¸­å¤®å±¤ï¼‰
- [ ] å¯©æ‰¹æ“ä½œä»‹é¢
- [ ] è·¨é™¢èª¿æ’¥è¿½è¹¤çœ‹æ¿

---

### Phase 4: ä¸­å¤®æŒ‡æ®å±¤ (2-3 é€±)

#### 4.1 å ±å‘Šç³»çµ±
- [ ] æ¥æ”¶é†«é™¢æ—¥å ± API
- [ ] ç·Šæ€¥é€šå ± API
- [ ] å ±å‘ŠæŸ¥è©¢èˆ‡çµ±è¨ˆ

#### 4.2 è³‡æºç¸½è¦½
- [ ] å…¨åœ‹/æˆ°å€è³‡æºç¸½è¦½ API
- [ ] é—œéµçŸ­ç¼ºè­¦å ±ç³»çµ±
- [ ] æˆ°ç•¥èª¿é…å»ºè­°ç³»çµ±

#### 4.3 å‰ç«¯ UI (ä¸­å¤®æŒ‡æ®ä»‹é¢)
- [ ] å…¨åœ‹è³‡æºåœ°åœ–è¦–è¦ºåŒ–
- [ ] é†«é™¢ç‹€æ…‹å„€è¡¨æ¿
- [ ] ç·Šæ€¥è­¦å ±åˆ—è¡¨
- [ ] è·¨é™¢èª¿æ’¥å¯©æ‰¹å·¥ä½œæµç¨‹

---

### Phase 5: é›¢ç·šèˆ‡å¯¦é«”è½‰ç§»å„ªåŒ– (1-2 é€±)

#### 5.1 é›¢ç·šæ¨¡å¼å¢å¼·
- [ ] å®Œå…¨é›¢ç·šé‹ä½œæ”¯æ´
- [ ] æœ¬åœ°è®Šæ›´ä½‡åˆ—
- [ ] è‡ªå‹•è¡çªè§£æ±ºç­–ç•¥

#### 5.2 å¯¦é«”è½‰ç§»å·¥å…·
- [ ] USB åŒæ­¥å°åŒ…è‡ªå‹•åµæ¸¬
- [ ] æ‰¹æ¬¡åŒ¯å…¥å¤šå€‹å°åŒ…
- [ ] å°åŒ…å®Œæ•´æ€§é©—è­‰å·¥å…·

---

## âš ï¸ é—œéµè¨­è¨ˆè€ƒé‡

### 1. ç¶²è·¯é™åˆ¶é©æ‡‰

**è¨­è¨ˆåŸå‰‡:**
- é è¨­æ‰€æœ‰ç«™é»ç„¡ç¶²è·¯
- å¤§ç«™ã€Œå¯èƒ½ã€æœ‰ç¶²è·¯ï¼ˆé€éè»è­¦ç®¡é“ï¼‰
- é†«é™¢è¡Œæ”¿å–®ä½ã€Œæ‡‰è©²ã€æœ‰ç¶²è·¯
- ä¸­å¤®æŒ‡æ®éƒ¨ã€Œå¿…é ˆã€æœ‰ç¶²è·¯

**é©æ‡‰ç­–ç•¥:**
- ç«™é»å±¤ï¼šå®Œå…¨é›¢ç·šå„ªå…ˆï¼ŒåŒæ­¥å°åŒ…è¨­è¨ˆ
- é†«é™¢å±¤ï¼šå®šæœŸæ‹‰å–ç«™é»æ›´æ–°ï¼Œæ¨é€å½™ç¸½å ±å‘Š
- ä¸­å¤®å±¤ï¼šæ¥æ”¶è¢«å‹•å ±å‘Šï¼Œç™¼å‡ºä¸»å‹•æŒ‡ä»¤

### 2. è³‡æ–™ä¸€è‡´æ€§

**å ´æ™¯ï¼šç«™é» A èˆ‡ç«™é» B é›¢ç·šæœŸé–“éƒ½æ¶ˆè€—äº†åŒä¸€æ‰¹ç‰©è³‡**

**è§£æ±ºæ–¹æ¡ˆ:**
- æ¯å€‹ç«™é»ç¨ç«‹ç®¡ç†åº«å­˜
- åŒæ­¥æ™‚ä»¥ã€Œäº‹ä»¶æ—¥èªŒã€ç‚ºæº–ï¼Œè€Œéã€Œæœ€çµ‚ç‹€æ…‹ã€
- é†«é™¢å±¤å½™ç¸½æ™‚åŠ ç¸½æ‰€æœ‰ç«™é»æ¶ˆè€—ï¼Œä¸åšé€†å‘ä¿®æ­£
- å®šæœŸç›¤é» (inventory audit) æ ¡æ­£èª¤å·®

### 3. è¡çªè§£æ±ºç­–ç•¥

| è¡çªé¡å‹ | è§£æ±ºç­–ç•¥ |
|---------|---------|
| ç‰©è³‡æ•¸é‡ä¸ä¸€è‡´ | ä»¥å¯¦éš›æ¶ˆè€—äº‹ä»¶ç‚ºæº–ï¼ŒåŠ ç¸½è¨ˆç®— |
| è¡€è¢‹åº«å­˜è¡çª | åŒä¸Šï¼Œä»¥äº‹ä»¶æ—¥èªŒç‚ºæº– |
| æ‰‹è¡“è¨˜éŒ„é‡è¤‡ | ä»¥ record_number ç‚ºå”¯ä¸€éµï¼Œå¾Œåˆ°çš„å¿½ç•¥ |
| è¨­å‚™ç‹€æ…‹è¡çª | ä»¥æ™‚é–“æˆ³è¼ƒæ–°çš„ç‚ºæº– |
| ç«™é»è³‡è¨Šè¡çª | ä»¥é†«é™¢å±¤è³‡æ–™ç‚ºæº–ï¼ˆè¦–ç‚ºæ¬Šå¨ä¾†æºï¼‰|

### 4. å¯©æ‰¹æµç¨‹

**è‡ªå‹•å¯©æ‰¹è¦å‰‡:**
- åŒä¸€é†«é™¢å…§çš„ç«™é–“èª¿æ’¥ï¼šè‡ªå‹•æ‰¹å‡†
- ç·Šæ€¥ç¨‹åº¦ CRITICAL + æ•¸é‡ < é–¾å€¼ï¼šè‡ªå‹•æ‰¹å‡†
- è¡€è¢‹èª¿æ’¥ï¼ˆä»»ä½•æ•¸é‡ï¼‰ï¼šéœ€äººå·¥å¯©æ‰¹
- è¨­å‚™èª¿æ’¥ï¼šéœ€äººå·¥å¯©æ‰¹

**äººå·¥å¯©æ‰¹æµç¨‹:**
1. è«‹æ±‚æ–¹æäº¤ç”³è«‹
2. ä¸­å¤®æŒ‡æ®éƒ¨å¯©æ ¸
3. ä¾›çµ¦æ–¹ç¢ºèªå¯æä¾›
4. ä¸­å¤®ä¸‹é”èª¿æ’¥æŒ‡ä»¤
5. å¯¦é«”é‹é€
6. æ¥æ”¶æ–¹ç¢ºèªæ”¶åˆ°

### 5. å®‰å…¨èˆ‡æ¬Šé™

**ä¸‰å±¤æ¬Šé™è¨­è¨ˆ:**

| å±¤ç´š | è§’è‰² | æ¬Šé™ |
|-----|------|-----|
| ç«™é»å±¤ | é†«è­·äººå“¡ | ç®¡ç†æœ¬ç«™ç‰©è³‡ã€è¨˜éŒ„æ‰‹è¡“ |
| ç«™é»å±¤ | ç«™é•· | + æäº¤åŒæ­¥å°åŒ…ã€è«‹æ±‚é™¢å…§æ”¯æ´ |
| é†«é™¢å±¤ | ç‰©è³‡ç®¡ç†å“¡ | æŸ¥çœ‹æ‰€æœ‰ç«™é»åº«å­˜ã€å”èª¿é™¢å…§èª¿æ’¥ |
| é†«é™¢å±¤ | é™¢é•·/æŒ‡æ®å®˜ | + æäº¤è·¨é™¢è«‹æ±‚ã€ç”¢ç”Ÿæ—¥å ± |
| ä¸­å¤®å±¤ | è³‡æ–™åˆ†æå“¡ | æŸ¥çœ‹æ‰€æœ‰å ±å‘Šèˆ‡çµ±è¨ˆ |
| ä¸­å¤®å±¤ | æŒ‡æ®å®˜ | + å¯©æ‰¹è·¨é™¢è«‹æ±‚ã€ä¸‹é”èª¿é…æŒ‡ä»¤ |

---

## ğŸ“± å‰ç«¯æ¶æ§‹å»ºè­°

### ç«™é»å±¤ä»‹é¢ (Station UI)
```
Index.html (ç¾æœ‰)
  â”œâ”€ ç‰©è³‡ç®¡ç†
  â”œâ”€ è¡€è¢‹ç®¡ç†
  â”œâ”€ è¨­å‚™ç®¡ç†
  â”œâ”€ æ‰‹è¡“è¨˜éŒ„
  â””â”€ [æ–°å¢] åŒæ­¥ç®¡ç†
       â”œâ”€ ç”¢ç”ŸåŒæ­¥å°åŒ… (ä¸‹è¼‰ .sync æª”æ¡ˆ)
       â”œâ”€ åŒ¯å…¥åŒæ­¥å°åŒ… (ä¸Šå‚³ .sync æª”æ¡ˆ)
       â”œâ”€ åŒæ­¥ç‹€æ…‹ (ä¸Šæ¬¡åŒæ­¥æ™‚é–“ã€å¾…åŒæ­¥è®Šæ›´æ•¸)
       â””â”€ åŒæ­¥æ­·å²è¨˜éŒ„
```

### é†«é™¢å±¤ä»‹é¢ (Hospital UI)
```
Hospital.html (æ–°å»º)
  â”œâ”€ é†«é™¢ç¸½è¦½å„€è¡¨æ¿
  â”‚    â”œâ”€ æ‰€å±¬ç«™é»åœ°åœ–
  â”‚    â”œâ”€ å„ç«™é»é‹ä½œç‹€æ…‹
  â”‚    â””â”€ ç‰©è³‡ç¸½é‡çµ±è¨ˆ
  â”œâ”€ ç«™é»ç®¡ç†
  â”‚    â”œâ”€ ç«™é»åˆ—è¡¨ (25 å€‹ç«™é»)
  â”‚    â”œâ”€ ç«™é»è©³æƒ… (åº«å­˜ã€è¨­å‚™ã€äººå“¡)
  â”‚    â””â”€ ç«™é»åŒæ­¥ç‹€æ…‹
  â”œâ”€ é™¢å…§èª¿æ’¥å”èª¿
  â”‚    â”œâ”€ å¿«é€Ÿèª¿æ’¥ (ç«™é»A â†’ ç«™é»B)
  â”‚    â”œâ”€ èª¿æ’¥è¨˜éŒ„æŸ¥è©¢
  â”‚    â””â”€ å¾…è™•ç†è«‹æ±‚
  â”œâ”€ è·¨é™¢è«‹æ±‚
  â”‚    â”œâ”€ æäº¤æ”¯æ´è«‹æ±‚
  â”‚    â”œâ”€ æˆ‘çš„è«‹æ±‚ç‹€æ…‹
  â”‚    â””â”€ æ”¶åˆ°çš„æ”¯æ´è«‹æ±‚
  â””â”€ æ—¥å ±ç®¡ç†
       â”œâ”€ ç”¢ç”Ÿæ—¥å ± (è‡ªå‹•å½™ç¸½)
       â”œâ”€ æäº¤ä¸­å¤®
       â””â”€ æ­·å²æ—¥å ±æŸ¥è©¢
```

### ä¸­å¤®å±¤ä»‹é¢ (Central UI)
```
Central.html (æ–°å»º)
  â”œâ”€ å…¨åœ‹è³‡æºåœ°åœ–
  â”‚    â”œâ”€ åœ°ç†ä½ç½®è¦–è¦ºåŒ–
  â”‚    â”œâ”€ å„é†«é™¢ç‹€æ…‹æ¨™è¨˜
  â”‚    â””â”€ ç·Šæ€¥è­¦å ±åœ–æ¨™
  â”œâ”€ é†«é™¢ç‹€æ…‹ç¸½è¦½
  â”‚    â”œâ”€ æ‰€æœ‰é†«é™¢åˆ—è¡¨
  â”‚    â”œâ”€ é—œéµæŒ‡æ¨™ (é‹ä½œç«™é»æ•¸ã€å‚·æ‚£æ•¸ã€åº«å­˜)
  â”‚    â””â”€ æ—¥å ±æ¥æ”¶ç‹€æ…‹
  â”œâ”€ è·¨é™¢èª¿æ’¥å¯©æ‰¹
  â”‚    â”œâ”€ å¾…å¯©æ‰¹è«‹æ±‚åˆ—è¡¨
  â”‚    â”œâ”€ å¯©æ‰¹æ“ä½œä»‹é¢
  â”‚    â””â”€ èª¿æ’¥é€²åº¦è¿½è¹¤
  â”œâ”€ è³‡æºç¸½è¦½
  â”‚    â”œâ”€ å…¨åœ‹è¡€è¢‹åº«å­˜
  â”‚    â”œâ”€ é—œéµç‰©è³‡åº«å­˜
  â”‚    â”œâ”€ è¨­å‚™åˆ†å¸ƒçµ±è¨ˆ
  â”‚    â””â”€ çŸ­ç¼ºè­¦å ±åˆ—è¡¨
  â””â”€ å ±å‘Šèˆ‡çµ±è¨ˆ
       â”œâ”€ æ¯æ—¥å½™ç¸½å ±å‘Š
       â”œâ”€ è¶¨å‹¢åˆ†æåœ–è¡¨
       â””â”€ è³‡æ–™åŒ¯å‡º
```

---

## ğŸ§ª æ¸¬è©¦å ´æ™¯

### å ´æ™¯ 1: é™¢å…§å°ç«™è«‹æ±‚å¤§ç«™æ”¯æ´ (ç„¡ç¶²è·¯)

```
åˆå§‹ç‹€æ…‹:
  TC-01 (å¤§ç«™, æœ‰ç¶²è·¯): å¤–ç§‘ç¸«åˆé‡ 100 æ”¯
  TC-05 (å°ç«™, ç„¡ç¶²è·¯): å¤–ç§‘ç¸«åˆé‡ 5 æ”¯

æµç¨‹:
1. TC-05 è¨˜éŒ„ç·Šæ€¥æ¶ˆè€— 5 æ”¯ç¸«åˆé‡ï¼Œåº«å­˜æ­¸é›¶
2. TC-05 è­·ç†å¸«ç”¢ç”ŸåŒæ­¥å°åŒ… PKG-001.sync (åŒ…å«æ¶ˆè€—è¨˜éŒ„)
3. å·¡è¿´é†«è­·äººå“¡ USB æ”¶é›† PKG-001.sync
4. é€è‡³é†«é™¢è¡Œæ”¿å–®ä½ï¼Œä¸Šå‚³åˆ°é†«é™¢å½™ç¸½è³‡æ–™åº«
5. é†«é™¢ç³»çµ±ç™¼ç¾ TC-05 ç¸«åˆé‡çŸ­ç¼ºè­¦å ±
6. ç‰©è³‡ç®¡ç†å“¡å”èª¿ï¼šTC-01 â†’ TC-05 èª¿æ’¥ 20 æ”¯
7. é†«é™¢ç”¢ç”Ÿå›å‚³å°åŒ… PKG-002.sync (åŒ…å«èª¿æ’¥è¨˜éŒ„)
8. ä¸‹æ¬¡å·¡è¿´æ™‚ USB é€å› TC-05
9. TC-05 åŒ¯å…¥ PKG-002.syncï¼Œåº«å­˜æ›´æ–°ç‚º 20 æ”¯

é©—è­‰:
  âœ“ TC-05 åº«å­˜æ›´æ–°æ­£ç¢º
  âœ“ TC-01 åº«å­˜æ‰£é™¤æ­£ç¢º
  âœ“ èª¿æ’¥è¨˜éŒ„å®Œæ•´
  âœ“ äº‹ä»¶æ—¥èªŒé›™å‘è¨˜éŒ„
```

### å ´æ™¯ 2: è·¨é™¢ç·Šæ€¥è¡€è¢‹æ”¯æ´

```
åˆå§‹ç‹€æ…‹:
  HOSP-001 TC-01: O+ è¡€è¢‹ 10 U
  HOSP-002 TC-01: O+ è¡€è¢‹ 150 U

æµç¨‹:
1. HOSP-001 ç™¼ç”Ÿå¤§é‡å‚·æ‚£ï¼ŒO+ è¡€è¢‹æ¶ˆè€—æ®†ç›¡
2. HOSP-001 é™¢é•·æäº¤ç·Šæ€¥è«‹æ±‚:
   POST /api/central/transfer-request
   {
     "from_hospital_id": "HOSP-002",
     "to_hospital_id": "HOSP-001",
     "resource_type": "BLOOD",
     "blood_type": "O+",
     "quantity_requested": 50,
     "urgency": "CRITICAL",
     "reason": "å¤§é‡å‡ºè¡€å‚·æ‚£ï¼Œè¡€è¢‹è€—ç›¡"
   }

3. ä¸­å¤®æŒ‡æ®éƒ¨æ”¶åˆ°è«‹æ±‚ (urgency=CRITICAL, resource=BLOOD)
   â†’ è‡ªå‹•é€šçŸ¥å€¼ç­æŒ‡æ®å®˜

4. æŒ‡æ®å®˜å¯©æ‰¹:
   POST /api/central/transfer-request/REQ-001/approve
   {
     "approved_by": "ä¸­å¤®æŒ‡æ®å®˜",
     "quantity_approved": 50,
     "delivery_method": "HELICOPTER"  // ç›´å‡æ©Ÿç·Šæ€¥é‹é€
   }

5. HOSP-002 æ”¶åˆ°é€šçŸ¥ (ä¸‹æ¬¡åŒæ­¥æˆ–æœ‰ç¶²è·¯æ™‚)
   GET /api/central/pending-requests
   â†’ çœ‹åˆ° REQ-001 å·²å¯©æ‰¹

6. HOSP-002 æº–å‚™ 50U O+ è¡€è¢‹ï¼Œç¢ºèªç™¼å‡º:
   POST /api/central/transfer-confirm
   {
     "request_id": "REQ-001",
     "status": "IN_TRANSIT",
     "actual_quantity": 50,
     "expected_delivery": "2025-11-12T16:00:00"
   }

7. ç›´å‡æ©Ÿé‹é€ (å¯¦é«”è½‰ç§»)

8. HOSP-001 æ”¶åˆ°è¡€è¢‹ï¼Œç¢ºèª:
   POST /api/central/transfer-received
   {
     "request_id": "REQ-001",
     "received_quantity": 50,
     "received_at": "2025-11-12T15:55:00"
   }

9. HOSP-001 TC-01 å…¥åº« 50U O+ è¡€è¢‹

é©—è­‰:
  âœ“ è·¨é™¢è«‹æ±‚è¨˜éŒ„å®Œæ•´
  âœ“ å¯©æ‰¹æµç¨‹æ­£ç¢º
  âœ“ é›™æ–¹åº«å­˜è®Šæ›´æ­£ç¢º
  âœ“ ä¸­å¤®å¯è¿½è¹¤èª¿æ’¥é€²åº¦
  âœ“ äº‹ä»¶æ™‚é–“è»¸å®Œæ•´
```

### å ´æ™¯ 3: é†«é™¢æ—¥å ±æäº¤èˆ‡ä¸­å¤®ç¸½è¦½

```
æµç¨‹:
1. æ¯æ—¥ 18:00ï¼ŒHOSP-001 é†«é™¢ç³»çµ±è‡ªå‹•å½™ç¸½:
   - æ‰€å±¬ 25 å€‹ç«™é»è³‡æ–™
   - ç•¶æ—¥çµ±è¨ˆ (å‚·æ‚£æ•¸ã€æ‰‹è¡“æ•¸)
   - ç•¶å‰åº«å­˜ (ç‰©è³‡ã€è¡€è¢‹ã€è¨­å‚™)
   - è­¦å ±äº‹é … (çŸ­ç¼ºã€è¨­å‚™æ•…éšœ)

2. ç”¢ç”Ÿæ—¥å ± RPT-20251112-HOSP-001

3. æäº¤è‡³ä¸­å¤®:
   POST /api/central/report/daily
   (åŒ…å«å®Œæ•´å½™ç¸½è³‡æ–™)

4. ä¸­å¤®ç³»çµ±æ¥æ”¶å¾Œ:
   - æ›´æ–° HOSP-001 åœ¨å…¨åœ‹åœ°åœ–ä¸Šçš„ç‹€æ…‹
   - æª¢æŸ¥çŸ­ç¼ºè­¦å ± â†’ ç™¼ç¾ HOSP-001 å¤–ç§‘ç¸«åˆé‡åš´é‡çŸ­ç¼º
   - è‡ªå‹•é€šçŸ¥é„°è¿‘é†«é™¢ (HOSP-002, HOSP-003)
   - æŒ‡æ®å®˜æŸ¥çœ‹å…¨åœ‹è³‡æºç¸½è¦½å„€è¡¨æ¿

5. ä¸­å¤®æŒ‡æ®å®˜æ±ºç­–:
   - HOSP-003 æœ‰å……è¶³å¤–ç§‘ç¸«åˆé‡åº«å­˜
   - ä¸»å‹•å»ºè­° HOSP-001 å‘ HOSP-003 è«‹æ±‚æ”¯æ´

é©—è­‰:
  âœ“ æ—¥å ±å½™ç¸½æ­£ç¢º
  âœ“ ä¸­å¤®æ¥æ”¶æˆåŠŸ
  âœ“ å…¨åœ‹ç¸½è¦½æ›´æ–°
  âœ“ çŸ­ç¼ºè­¦å ±æ­£ç¢ºè§¸ç™¼
  âœ“ æ±ºç­–æ”¯æ´è³‡è¨Šå®Œæ•´
```

---

## ğŸ“ æ¶æ§‹æ¯”è¼ƒ

### ä¹‹å‰çš„ã€Œé›†ä¸­å¼+é›¢ç·šå‚™ä»½ã€æ¶æ§‹
```
å„ªé»:
  âœ“ å¯¦ä½œç°¡å–®
  âœ“ è³‡æ–™ä¸€è‡´æ€§å®¹æ˜“ä¿è­‰
  âœ“ é©åˆå°è¦æ¨¡éƒ¨ç½²

ç¼ºé»:
  âœ— ä¸ç¬¦åˆå¯¦éš›é†«é™¢çµ„ç¹”çµæ§‹
  âœ— ç„¡æ³•è™•ç†é »ç¹çš„é™¢å…§å”ä½œ
  âœ— è·¨é™¢è«‹æ±‚ç¼ºä¹å¯©æ‰¹æ©Ÿåˆ¶
  âœ— ä¸­å¤®æŒ‡æ®ç„¡æ³•æœ‰æ•ˆç›£æ§å…¨å±€
```

### ç¾åœ¨çš„ã€Œè¯é‚¦å¼ä¸‰å±¤ã€æ¶æ§‹
```
å„ªé»:
  âœ“ ç¬¦åˆå¯¦éš›é†«é™¢çµ„ç¹”çµæ§‹
  âœ“ æ”¯æ´é »ç¹é™¢å…§åŒæ­¥èˆ‡èª¿æ’¥
  âœ“ è·¨é™¢è«‹æ±‚æœ‰å®Œæ•´å¯©æ‰¹æµç¨‹
  âœ“ ä¸­å¤®å¯æœ‰æ•ˆç›£æ§èˆ‡æ±ºç­–
  âœ“ ç¶²è·¯é™åˆ¶ä¸‹ä¾ç„¶å¯é‹ä½œ
  âœ“ å„å±¤ç´šæ¬Šè²¬åˆ†æ˜

ç¼ºé»:
  âœ— å¯¦ä½œè¤‡é›œåº¦è¼ƒé«˜
  âœ— éœ€è¦æ›´å¤šè³‡æ–™åº«è¨­è¨ˆ
  âœ— åŒæ­¥æ©Ÿåˆ¶è¼ƒè¤‡é›œ
  âœ— éœ€è¦ä¸‰å¥—ä¸åŒçš„å‰ç«¯ä»‹é¢
```

---

## ğŸ’¡ å¯¦ä½œå»ºè­°

### 1. æ¼¸é€²å¼é·ç§»

**ä¸è¦ä¸€æ¬¡å…¨éƒ¨é‡æ§‹ï¼** å»ºè­°åˆ†éšæ®µï¼š

**Step 1:** ä¿æŒç¾æœ‰å–®ç«™åŠŸèƒ½ï¼Œæ–°å¢ hospital_id æ¬„ä½
**Step 2:** å¯¦ä½œåŒæ­¥å°åŒ…æ©Ÿåˆ¶ï¼ˆå…ˆæ¸¬è©¦å…©å€‹ç«™é»ï¼‰
**Step 3:** å¯¦ä½œé†«é™¢å±¤å½™ç¸½åŠŸèƒ½
**Step 4:** å¯¦ä½œè·¨é™¢è«‹æ±‚èˆ‡å¯©æ‰¹
**Step 5:** å¯¦ä½œä¸­å¤®æŒ‡æ®å±¤ä»‹é¢

### 2. è³‡æ–™é·ç§»è…³æœ¬

```python
# migration_to_federated.py

def migrate_to_federated():
    # 1. å»ºç«‹é è¨­é†«é™¢
    cursor.execute("""
        INSERT INTO hospitals (hospital_id, hospital_name, hospital_type, command_level)
        VALUES ('HOSP-001', 'å‰ç·šç¬¬ä¸€é†«é™¢', 'FIELD_HOSPITAL', 'LOCAL')
    """)

    # 2. å°‡ç¾æœ‰ç«™é»æ­¸å±¬åˆ°é è¨­é†«é™¢
    cursor.execute("""
        UPDATE stations
        SET hospital_id = 'HOSP-001',
            station_type = CASE
                WHEN station_id IN ('TC-01', 'TC-02') THEN 'LARGE'
                ELSE 'SMALL'
            END
    """)

    # 3. å»ºç«‹åˆå§‹åŒæ­¥åŸºæº–é»
    cursor.execute("""
        INSERT INTO sync_packages (package_id, source_type, source_id, destination_type, destination_id, hospital_id, transfer_method, status)
        SELECT
            'PKG-INITIAL-' || station_id,
            'STATION',
            station_id,
            'HOSPITAL',
            'HOSP-001',
            'HOSP-001',
            'INITIAL',
            'APPLIED'
        FROM stations
    """)

    conn.commit()
```

### 3. æ¸¬è©¦ç­–ç•¥

**å–®æ©Ÿæ¸¬è©¦ç’°å¢ƒ:**
1. å•Ÿå‹•ä¸€å€‹ main.py (8000 port)
2. é–‹å•Ÿå¤šå€‹ç€è¦½å™¨åˆ†é :
   - åˆ†é  1: TC-01 (å¤§ç«™)
   - åˆ†é  2: TC-05 (å°ç«™)
   - åˆ†é  3: HOSP-001 (é†«é™¢å±¤ä»‹é¢)
   - åˆ†é  4: CENTRAL (ä¸­å¤®å±¤ä»‹é¢)
3. æ¨¡æ“¬åŒæ­¥å°åŒ…ç”¢ç”Ÿèˆ‡åŒ¯å…¥æµç¨‹

---

## ğŸ“ å¾ŒçºŒæ”¯æ´

å¦‚æœ‰å•é¡Œæˆ–éœ€è¦é€²ä¸€æ­¥è¨­è¨ˆç´°ç¯€ï¼Œè«‹æå‡ºã€‚

**é—œéµæ±ºç­–é»éœ€è¦ç¢ºèª:**
1. æ˜¯å¦æ¡ç”¨æ­¤è¯é‚¦å¼ä¸‰å±¤æ¶æ§‹ï¼Ÿ
2. å„ªå…ˆå¯¦ä½œå“ªå€‹ Phaseï¼Ÿ
3. ä¸­å¤®å±¤æ˜¯å¦éœ€è¦ç¨ç«‹éƒ¨ç½²ï¼ˆä¸åŒä¼ºæœå™¨ï¼‰ï¼Ÿ
4. æ˜¯å¦éœ€è¦å¤šèªè¨€æ”¯æ´ï¼ˆè‹±æ–‡/ä¸­æ–‡ï¼‰ï¼Ÿ

---

**ç‰ˆæœ¬**: v2.0-FEDERATED
**å»ºç«‹æ—¥æœŸ**: 2025-11-12
**æœ€å¾Œæ›´æ–°**: 2025-11-12
**æ¶æ§‹é¡å‹**: è¯é‚¦å¼ä¸‰å±¤ (Federated Three-Tier)
